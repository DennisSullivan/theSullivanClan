<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jigsaw Puzzle • SullivanClan</title>

<style>
  body {
    background: #f7f3e8;
    font-family: "Trebuchet MS", sans-serif;
    margin: 0;
    padding: 0;
    text-align: center;
  }

  header {
    background: linear-gradient(135deg, #ffb36b, #ff8a5c);
    color: white;
    padding: 22px;
    font-size: 30px;
    font-weight: bold;
    letter-spacing: 1px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.25);
  }

  .container {
    max-width: 500px;
    margin: 30px auto;
    padding: 10px;
  }

  #board {
    width: 320px;
    height: 320px;
    margin: 0 auto;
    position: relative;
    background: #ddd;
    border-radius: 10px;
    overflow: hidden;
  }

  .piece {
    width: 80px;
    height: 80px;
    position: absolute;
    background-size: 320px 320px;
    border-radius: 6px;
    cursor: grab;
    transition: none;

    /* Prevent mobile tap zoom / highlight */
    -webkit-tap-highlight-color: transparent;
    touch-action: none;
  }

  .piece:active {
    transform: none !important; /* Prevent expand/shrink */
  }

  .piece:focus {
    outline: none;
  }

  button {
    margin-top: 25px;
    padding: 12px 22px;
    font-size: 18px;
    border: none;
    border-radius: 8px;
    background: #6bb8ff;
    color: white;
    cursor: pointer;
    box-shadow: 0 3px 5px rgba(0,0,0,0.25);
    transition: 0.2s;
  }

  button:hover {
    background: #4aa6ff;
    transform: scale(1.05);
  }

  .back-link {
    display: inline-block;
    margin-top: 30px;
    color: #444;
    font-size: 18px;
    text-decoration: none;
  }
</style>
</head>

<body>

<header>Jigsaw Puzzle</header>

<div class="container">
  <p>Drag each piece into the correct position.</p>

  <div id="board"></div>

  <button onclick="shufflePieces()">Shuffle</button>

  <div>
    <a class="back-link" href="index.html">← Back to Puzzles</a>
  </div>
</div>

<script>
const board = document.getElementById("board");
const size = 4; // 4x4 puzzle
const tileSize = 80;
let pieces = [];
let dragging = null;
let offsetX = 0;
let offsetY = 0;

function createPieces() {
  pieces = [];
  board.innerHTML = "";

  for (let r = 0; r < size; r++) {
    for (let c = 0; c < size; c++) {
      const index = r * size + c;

      const piece = document.createElement("div");
      piece.className = "piece";
      piece.style.backgroundImage = "url('puzzle.jpg')";
      piece.style.backgroundPosition = `-${c * tileSize}px -${r * tileSize}px`;

      piece.dataset.correctX = c;
      piece.dataset.correctY = r;

      piece.addEventListener("pointerdown", startDrag);
      piece.addEventListener("pointermove", drag);
      piece.addEventListener("pointerup", endDrag);
      piece.addEventListener("pointercancel", endDrag);

      pieces.push(piece);
      board.appendChild(piece);
    }
  }

  shufflePieces();
}

function shufflePieces() {
  pieces.forEach(piece => {
    const x = Math.floor(Math.random() * size);
    const y = Math.floor(Math.random() * size);
    piece.style.left = x * tileSize + "px";
    piece.style.top = y * tileSize + "px";
  });
}

function startDrag(e) {
  dragging = e.target;

  const rect = dragging.getBoundingClientRect();
  offsetX = e.clientX - rect.left;
  offsetY = e.clientY - rect.top;

  dragging.setPointerCapture(e.pointerId);
}

function drag(e) {
  if (!dragging) return;

  const boardRect = board.getBoundingClientRect();

  let x = e.clientX - boardRect.left - offsetX;
  let y = e.clientY - boardRect.top - offsetY;

  // Keep inside board
  x = Math.max(0, Math.min(x, boardRect.width - tileSize));
  y = Math.max(0, Math.min(y, boardRect.height - tileSize));

  dragging.style.left = x + "px";
  dragging.style.top = y + "px";
}

function endDrag(e) {
  if (!dragging) return;

  const boardRect = board.getBoundingClientRect();

  let x = e.clientX - boardRect.left - offsetX;
  let y = e.clientY - boardRect.top - offsetY;

  // Snap to nearest grid cell
  const col = Math.round(x / tileSize);
  const row = Math.round(y / tileSize);

  dragging.style.left = col * tileSize + "px";
  dragging.style.top = row * tileSize + "px";

  dragging.releasePointerCapture(e.pointerId);
  dragging = null;
}

createPieces();
</script>

</body>
</html>
