/* ============================================================
   FILE: domino.css
   PURPOSE: Final unified stylesheet for the two‑element DOM model.
   CONTRACT:
     - Wrapper handles placement + rotation.
     - Inner .domino handles orientation + pip grid.
     - Halves contain 3×3 pip grids.
     - Pip visibility driven by data-pip.
   ============================================================ */

/* ------------------------------------------------------------
   ROOT VARIABLES
   ------------------------------------------------------------ */
:root {
  --cell-size: 48px;
  --cell-gap: 4px;

  --domino-bg: #ffffff;
  --domino-border: #000;
  --pip-color: #000;

  --domino-radius: 6px;
  --transition-fast: 120ms ease-out;
}

/* ============================================================
   WRAPPER (placement + rotation)
   ============================================================ */

.domino-wrapper {
  position: absolute;
  width: calc(2 * var(--cell-size) + var(--cell-gap));
  height: var(--cell-size);
  display: flex;
  align-items: center;
  justify-content: center;
  pointer-events: auto;
  touch-action: none;
  transform-origin: center center;
}

/* Board placement (half0 anchor) */
.domino-wrapper.on-board {
  transform: translate(
    calc(var(--col) * (var(--cell-size) + var(--cell-gap))),
    calc(var(--row) * (var(--cell-size) + var(--cell-gap)))
  );
}

/* Tray rotation (visual-only) */
.domino-wrapper.in-tray {
  position: relative;
  transform: rotate(var(--angle));
  transition: transform var(--transition-fast);
}

/* Ghost preview */
.domino-wrapper.ghost {
  opacity: 0.5;
  filter: grayscale(100%);
  pointer-events: none;
}

/* ============================================================
   INNER DOMINO (orientation + border)
   ============================================================ */

.domino {
  display: flex;
  width: 100%;
  height: 100%;
  border-radius: var(--domino-radius);
  background: var(--domino-bg);
  border: 2px solid var(--domino-border);
  box-sizing: border-box;
  overflow: hidden;
  pointer-events: none; /* required by two-element model */
}

/* Orientation set by renderDomino() */
.domino.horizontal {
  flex-direction: row;
}

.domino.vertical {
  flex-direction: column;
  width: var(--cell-size);
  height: calc(2 * var(--cell-size) + var(--cell-gap));
}

/* Tray vs board visual distinction */
.domino-wrapper.in-tray .domino {
  box-shadow: 0 1px 2px rgba(0,0,0,0.25);
}

.domino-wrapper.on-board .domino {
  box-shadow: none;
}

/* ============================================================
   HALVES (3×3 pip grid)
   ============================================================ */

.domino .half {
  flex: 1;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-template-rows: repeat(3, 1fr);
  justify-items: center;
  align-items: center;
  box-sizing: border-box;
}

/* Divider (horizontal or vertical) */
.domino.horizontal .half + .half {
  border-left: 1px solid var(--domino-border);
}

.domino.vertical .half + .half {
  border-top: 1px solid var(--domino-border);
}

/* ============================================================
   PIPS (7-position grid)
   ============================================================ */

.domino .pip {
  width: calc(var(--cell-size) * 0.095);
  height: calc(var(--cell-size) * 0.095);
  background: var(--pip-color);
  border-radius: 50%;
  opacity: 0;
  transition: opacity var(--transition-fast);
}

/* Pip positions */
.p1 { grid-area: 2 / 2; }
.p2 { grid-area: 1 / 1; }
.p3 { grid-area: 3 / 3; }
.p4 { grid-area: 1 / 3; }
.p5 { grid-area: 3 / 1; }
.p6 { grid-area: 2 / 1; }
.p7 { grid-area: 2 / 3; }

/* Slightly larger center pips */
.p7 {
  width: calc(var(--cell-size) * 0.105);
  height: calc(var(--cell-size) * 0.105);
}

/* ============================================================
   PIP ACTIVATION RULES (data-pip)
   ============================================================ */

.domino .half[data-pip="0"] .pip { opacity: 0; }

.domino .half[data-pip="1"] .p1 { opacity: 1; }

.domino .half[data-pip="2"] .p2,
.domino .half[data-pip="2"] .p3 { opacity: 1; }

.domino .half[data-pip="3"] .p2,
.domino .half[data-pip="3"] .p1,
.domino .half[data-pip="3"] .p3 { opacity: 1; }

.domino .half[data-pip="4"] .p2,
.domino .half[data-pip="4"] .p3,
.domino .half[data-pip="4"] .p4,
.domino .half[data-pip="4"] .p5 { opacity: 1; }

.domino .half[data-pip="5"] .p2,
.domino .half[data-pip="5"] .p3,
.domino .half[data-pip="5"] .p4,
.domino .half[data-pip="5"] .p5,
.domino .half[data-pip="5"] .p1 { opacity: 1; }

.domino .half[data-pip="6"] .p2,
.domino .half[data-pip="6"] .p3,
.domino .half[data-pip="6"] .p4,
.domino .half[data-pip="6"] .p5,
.domino .half[data-pip="6"] .p6,
.domino .half[data-pip="6"] .p7 { opacity: 1; }

/* ============================================================
   BOARD CELLS
   ============================================================ */

.board-cell {
  width: var(--cell-size);
  height: var(--cell-size);
  background: #eee;
  border-radius: 4px;
  position: relative;
}

.board-cell.blocked {
  background: #bbb;
}

/* ============================================================
   TRAY SLOTS
   ============================================================ */

.tray-slot {
  width: calc(2 * var(--cell-size) + var(--cell-gap));
  height: var(--cell-size);
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
}
