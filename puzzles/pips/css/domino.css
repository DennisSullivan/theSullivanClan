/* ============================================================
   FILE: domino.css
   PURPOSE: Drop-in replacement for domino visuals (NYT-style)
   USAGE: Replace your existing domino.css with this file. It
          assumes global CSS variables are defined (e.g.
          --cell-size, --cell-gap, --domino-thickness). It
          applies the static visual nudge to the inner .domino
          so the painted seam aligns with the grid.
   ============================================================ */

/* -------------------------
   Core assumptions (use existing vars)
   - --cell-size
   - --cell-gap
   - --domino-thickness
   - --color-domino-bg
   - --color-domino-border
   - --color-pip
   - --transition-fast
   - --domino-nudge-x / --domino-nudge-y (optional overrides)
   ------------------------- */

/* Safety defaults if variables are missing (won't override your root) */
:root {
  --_fallback-cell-size: 48px;
  --_fallback-cell-gap: 4px;
  --_fallback-domino-thickness: 1px;
  --_fallback-color-domino-bg: #ffffff;
  --_fallback-color-domino-border: #aaa;
  --_fallback-color-pip: #222;
  --_fallback-transition-fast: 120ms ease-out;

  /* sensible default nudge (computed from geometry in your setup) */
  --domino-nudge-x: 2px;
  --domino-nudge-y: 2px;
}

/* -------------------------
   Wrapper (neutral)
   - wrapper sizing is controlled by board.css / tray.css
   - keep wrapper free of translate; rotation may be applied there
   ------------------------- */
.domino-wrapper {
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  transform-origin: center center;
  box-sizing: border-box;
  pointer-events: auto;
}

/* -------------------------
   Domino core (fills wrapper exactly)
   - box-sizing: border-box so borders/padding stay inside width/height
   - internal padding used for pip spacing (keeps halves gap-free)
   ------------------------- */
.domino {
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: row;
  background: var(--color-domino-bg, var(--_fallback-color-domino-bg));
  border: var(--domino-thickness, var(--_fallback-domino-thickness)) solid var(--color-domino-border, var(--_fallback-color-domino-border));
  border-radius: 4px;
  box-sizing: border-box;
  transform-origin: center center;
  pointer-events: auto;

  /* internal padding keeps pips compact without shrinking the domino */
  padding: calc(var(--cell-size, var(--_fallback-cell-size)) * 0.08);
}

/* -------------------------
   Apply static visual nudge to inner domino
   - This ensures the painted domino pixels shift relative to the grid
   - Keeps rotation on the wrapper (so rotation and translate compose)
   - Remove nudge while dragging to avoid cursor/ghost mismatch
   ------------------------- */
.domino.on-board {
  transform: translate(var(--domino-nudge-x, 2px), var(--domino-nudge-y, 2px));
  transform-origin: center center;
  box-sizing: border-box;
}

.domino-wrapper.on-board.dragging .domino {
  transform: translate(0, 0);
}

/* If your renderer sets rotation via --angle in CSS, keep it on wrapper:
   .domino-wrapper.on-board { transform: rotate(var(--angle, 0deg)); }
   If renderer sets inline rotation, the inner translate still composes. */

/* -------------------------
   Halves: 3x3 pip grid, no gap
   - gap = 0 so pips remain compact; spacing handled by .domino padding
   ------------------------- */
.domino .half {
  flex: 1;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-template-rows: repeat(3, 1fr);
  justify-items: center;
  align-items: center;
  gap: 0;
  padding: 0;
  font-size: 0;
  border-right: 1px solid var(--color-domino-border, var(--_fallback-color-domino-border));
}

.domino .half1 {
  border-right: none;
}

/* -------------------------
   Pips (NYT proportions)
   - pip size scales with cell size
   ------------------------- */
.domino .pip {
  width: calc(var(--cell-size, var(--_fallback-cell-size)) * 0.095);
  height: calc(var(--cell-size, var(--_fallback-cell-size)) * 0.095);
  background: var(--color-pip, var(--_fallback-color-pip));
  border-radius: 50%;
  opacity: 0;
  transition: opacity var(--transition-fast, var(--_fallback-transition-fast));
}

/* pip positions (3x3 grid) */
.p1 { grid-area: 2 / 2; }
.p2 { grid-area: 1 / 1; }
.p3 { grid-area: 3 / 3; }
.p4 { grid-area: 1 / 3; }
.p5 { grid-area: 3 / 1; }
.p6 { grid-area: 2 / 1; }
.p7 { grid-area: 2 / 3; }

/* pip patterns */
.domino .half[data-pip="1"] .p1 { opacity: 1; }

.domino .half[data-pip="2"] .p2,
.domino .half[data-pip="2"] .p3 { opacity: 1; }

.domino .half[data-pip="3"] .p2,
.domino .half[data-pip="3"] .p1,
.domino .half[data-pip="3"] .p3 { opacity: 1; }

.domino .half[data-pip="4"] .p2,
.domino .half[data-pip="4"] .p3,
.domino .half[data-pip="4"] .p4,
.domino .half[data-pip="4"] .p5 { opacity: 1; }

.domino .half[data-pip="5"] .p2,
.domino .half[data-pip="5"] .p3,
.domino .half[data-pip="5"] .p4,
.domino .half[data-pip="5"] .p5,
.domino .half[data-pip="5"] .p1 { opacity: 1; }

.domino .half[data-pip="6"] .p2,
.domino .half[data-pip="6"] .p3,
.domino .half[data-pip="6"] .p4,
.domino .half[data-pip="6"] .p5,
.domino .half[data-pip="6"] .p6,
.domino .half[data-pip="6"] .p7 { opacity: 1; }

/* -------------------------
   Visual states
   ------------------------- */
.domino.in-tray {
  box-shadow: 0 1px 2px rgba(0,0,0,0.25);
}

.domino.on-board {
  box-shadow: none;
}

/* -------------------------
   Mobile scaling
   ------------------------- */
@media (max-width: 600px) {
  .domino .pip {
    width: calc(var(--cell-size, var(--_fallback-cell-size)) * 0.10);
    height: calc(var(--cell-size, var(--_fallback-cell-size)) * 0.10);
  }

  .domino {
    padding: calc(var(--cell-size, var(--_fallback-cell-size)) * 0.10);
  }

  .domino .half {
    gap: 0;
  }
}

/* -------------------------
   Debug helpers (toggle classes in DevTools)
   ------------------------- */
.domino-wrapper.on-board.debug-outline { outline: 1px dashed rgba(255,0,0,0.6); }
.domino.on-board.debug-outline { outline: 1px solid rgba(0,255,0,0.6); }
.board-cell.debug-outline { outline: 1px dotted rgba(0,0,255,0.25); }
